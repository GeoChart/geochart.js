var geochartjs=geochartjs||{};geochartjs.utils=function(){"use strict";return{formatNumber:function(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,"'"),b.join(".")},retrieveGetArgumentsFromUrl:function(){for(var a=window.location.search.substr(1),b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("=");"undefined"!==e[0]&&null!==e[0]&&(c[e[0]]=e[1])}return c}}}(jQuery),geochartjs.errorHandling=function(a,b){"use strict";function c(){var a="No data received",b="While trying to get the data from the database, an error occured and no data was transferred to the webpage. Please reload this page again.";e(a,b)}function d(){var a="Error occured",b="An error occured during execution. Please reload this page.";e(a,b)}function e(a,b){var c=$("#globalError");c.find(".title").text(a),c.find(".message").text(b),c.fadeIn("fast")}"undefined"!=typeof a&&null!==a?a.hasOwnProperty("error")?a.error.hasOwnProperty("title")&&a.error.hasOwnProperty("message")?e(a.error.title,a.error.message):d():"undefined"!=typeof b&&b():c()},geochartjs.map=function(a,b,c,d,e,f){"use strict";function g(b,c){a(gb.container).addClass("noControls"),h(b,c)}function h(a,d){_=a,ab=d,l(),n(),b.json(_,function(a){$=c.feature(a,a.objects[gb.mapName]),b.json(ab,function(a){var b=a.data;q(b),p(),$=r($,b),k(),j(b.date),i(b.csv),I(),s(),B(),O()})}),C(),D(),G(),K(),H(),L()}function i(b){var c=a(".list .csvDownload");S(b)?c.attr("href",b):c.remove()}function j(b){var c=d(b.value,b.format).format("DD.MM.YYYY");a(gb.container+" .slide-menu h2 .date").text("("+c+")")}function k(){var b=a(gb.container+" .slide-menu .list table tbody");b.empty(),b.loadTemplate(a("#slide-menu-table-template"),hb),a(".data-type-chooser .scroll-pane").loadTemplate(a("#data-type-chooser-template"),ib).find("span").addClass("tab"),J(),M()}function l(){T=b.select(gb.container).append("svg"),X=b.geo.equirectangular(),pb.isInFullscreen()?(W=a(gb.container).height(),V=2*W,T.attr({width:a(gb.container).width(),height:a(gb.container).height()}),X.translate([V/2,W/2]).scale(V/2/Math.PI)):(V=a(gb.container).width(),W=V/2,T.attr({width:V,height:W}),X.translate([V/2,W/2]).scale(V/2/Math.PI)),a(gb.container).removeClass(gb.smallMapClass),V<gb.thresholdToSmallMap&&a(gb.container).addClass(gb.smallMapClass),Y=b.geo.path().projection(X),Z=b.behavior.zoom().scaleExtent(gb.zoomRange).on("zoom",A),U=T.append("g").style("opacity",0),T.call(Z).call(Z.event).on("click",m,!0),cb=a(window).width()}function m(){b.event.defaultPrevented&&b.event.stopPropagation()}function n(){b.select(window).on("resize",function(){var c=a(gb.container).is("."+gb.fullscreenClass),d=cb!==a(window).width();nb&&!c||!c&&!d||(cb=a(window).width(),window.clearTimeout(bb),b.select(gb.container+" .overlay").transition().duration(200).style("opacity",0),a(gb.container+" .single-country-info").hide(),bb=window.setTimeout(function(){o(),a("html,body").animate({scrollTop:a(gb.container).offset().top},"fast")},300))})}function o(){T.remove(),l(),z(void 0),s()}function p(){jb.domain([0,mb(lb)])}function q(a){lb=b.max(a.countries,function(a){return parseInt(a.OBSERVED_PEERS,10)})}function r(a,b){hb=[];for(var c=0;c<b.countries.length;c++){for(var d=!1,e=b.countries[c].COUNTRY_CODE,f=parseInt(b.countries[c].OBSERVED_PEERS,10),g=parseInt(b.countries[c].MAX_SWARM_SIZE,10),h=parseFloat(b.countries[c].PERCENTAGE),i=0;i<a.features.length;i++){var j=a.features[i].properties.iso_a2;e===j&&(a.features[i].properties.observedPeers=f,a.features[i].properties.maxSwarmSize=g,a.features[i].properties.percentage=h,d=!0,hb.push({ranking:c+1,observedPeers:f,maxSwarmSize:g,percentage:h,countryName:a.features[i].properties.name,countryCode:e,continent:a.features[i].properties.continent}))}d||hb.push({ranking:c+1,observedPeers:f,maxSwarmSize:g,percentage:h,countryName:e,countryCode:e,continent:void 0})}var k=parseInt(b.NOT_LOCATABLE_PEERS,10),l=parseFloat(b.NOT_LOCATABLE_PERCENTAGE);k>0&&hb.push({ranking:"&nbsp;",observedPeers:k,maxSwarmSize:"&ndash;",percentage:l,countryName:gb.notLocatableTitle,countryCode:gb.notLocatableTitle,continent:void 0});for(var m=0;m<hb.length;m++)hb[m].color=hb[m].countryName===gb.notLocatableTitle?fb.mapListColorNotLocatable:pb.getColor({properties:{observedPeers:hb[m].observedPeers}});return a}function s(){U.selectAll("path").data($.features).enter().append("path").attr("d",Y).style("fill",v).style("stroke-width",fb.strokeWidthMax+"px").style("stroke",w).style("cursor",u).on("click",x),t(),U.transition().duration(700).style("opacity",1),b.select(gb.container+" .overlay").transition().duration(700).style("opacity",1)}function t(){U.selectAll("path").each(function(b){if(!pb.hasPeerData(b)){var c=a(this).parent()[0],d=a(c).children().first()[0];c.insertBefore(this,d)}})}function u(a){return pb.hasPeerData(a)?"pointer":void 0}function v(a){return pb.hasPeerData(a)?pb.getColor(a):fb.colorNoData}function w(a){return pb.hasPeerData(a)?pb.getStrokeColor(a):fb.strokeColor}function x(a){var c=b.rgb(fb.selectedColor).toString(),d=b.rgb(b.select(this).style("fill")).toString(),e=c===d;pb.hasPeerData(a)&&!e&&(U.selectAll("path").style("fill",v).style("stroke",w),b.select(this.parentNode.appendChild(this)).transition().style({fill:fb.selectedColor,stroke:fb.selectedStrokeColor}),y(a),z(a))}function y(b){a(".single-country-info").fadeIn(),a(".single-country-info").loadTemplate(a("#single-country-info-template"),b.properties)}function z(b){var c=a(gb.container+" .mapList .list"),d=c.find("table tbody tr");if(d.removeClass("selected"),"undefined"!=typeof b){var e=b.properties.iso_a2;d.each(function(){a(this).data("country-code")===e&&a(this).addClass("selected")})}}function A(){b.event.scale<1&&(b.event.scale=1);var a=b.event.translate,c=b.event.scale;a=P(a,c),Q(c),U.selectAll("path").style("stroke-width",kb(c)+"px"),U.attr("transform","translate("+a+")scale("+c+")")}function B(){a(gb.container+" .functionSelect").fadeIn()}function C(){function b(b){var c=!a(this).hasClass("inactive"),d=b.zoomIn===!0||b.zoomIn===!1;if(c&&d){var e=Z.scale(),f=Z.translate(),g=[f[0]-V/2,f[1]-W/2],h=Math.round(b.zoomIn?e+1:e-1),i=[g[0]/e*h,g[1]/e*h],j=[i[0]+V/2,i[1]+W/2];j=P(j,h),T.transition().duration(100).call(h>=gb.zoomRange[0]&&h<=gb.zoomRange[1]?Z.scale(h).translate(j).event:h>gb.zoomRange[1]?Z.scale(gb.zoomRange[1]).translate(j).event:Z.scale(gb.zoomRange[0]).translate(j).event)}}a(gb.container+" .zoom-plus").click(function(){b.apply(this,[{zoomIn:!0}])}),a(gb.container+" .zoom-minus").click(function(){b.apply(this,[{zoomIn:!1}])})}function D(){a(gb.container+" .fullscreen-open").click(function(){a(this).is(":not(:hidden)")&&(E(a(gb.container)),a(gb.container).addClass(gb.fullscreenClass),a("html").css({overflow:"hidden"}),a(gb.container+" .single-country-info").fadeOut(),a(this).fadeOut(),a(gb.container+" .fullscreen-close").fadeIn(),I(),o())}),a(gb.container+" .fullscreen-close").click(function(){a(this).is(":not(:hidden)")&&(F(),a(gb.container).removeClass(gb.fullscreenClass),a("html").css({overflow:"visible"}),a(gb.container+" .single-country-info").fadeOut(),a(this).fadeOut(),a(gb.container+" .fullscreen-open").fadeIn(),o(),I())})}function E(a){var b=a[0];b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()}function F(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function G(){var b=a(gb.container+" .slide-menu .menu"),c=a(gb.container+" .show-slide-menu-button"),d=a(gb.container+" .hide-slide-menu-area");c.click(function(){b.animate({left:0}),c.fadeOut(),d.fadeIn(),"undefined"!=typeof eb&&db.scrollToX(eb.position().left-30)}),d.click(function(){b.animate({left:-(b.outerWidth()+20)}),c.fadeIn(),d.fadeOut()})}function H(){a(gb.container+" .functionSelect").change(function(){mb=ob[a(this).find("option:selected").val()],p(),a(".single-country-info").hide(),o()})}function I(){a(".list .scroll-pane").jScrollPane({verticalDragMinHeight:70})}function J(){var b=a(".data-type-chooser"),c=b.find(".scroll-pane");db=c.jScrollPane({showArrows:!0,animateScroll:!0,speed:200}).data("jsp")}function K(){a(".button.settings").click(function(){var b=a(this).find(".icon-settings"),c=a(this).find(".icon-settings-hide");a(this).hasClass("shown")?(a(this).removeClass("shown"),a(this).animate({bottom:10},"fast"),a(".settingsWrapper").animate({bottom:-55},"fast"),c.fadeOut("fast"),b.fadeIn("fast")):(a(this).addClass("shown"),a(this).animate({bottom:50},"fast"),a(".settingsWrapper").animate({bottom:10},"fast"),c.fadeIn("fast"),b.fadeOut("fast"))})}function L(){a(".button.dataTypeSelect").change(function(){var b=a(this).find("option:selected").val();N(b)})}function M(){var b=a(".data-type-chooser .tab");b.click(function(){var b=a(this).data("type");a(".button.dataTypeSelect").val(b),db.scrollToX(a(this).position().left-30),N(b)})}function N(b){eb=a(".data-type-chooser .tab[data-type="+b+"]");var c=a(".data-type-chooser .tab");c.removeClass("active"),c.filter("[data-type="+b+"]").addClass("active")}function O(){a("select.dataTypeSelect").loadTemplate(a("#data-type-chooser-select-template"),ib)}function P(b,c){if(pb.isInFullscreen()){var d=(a(gb.container).width()-V)*c-a(gb.container).width()*(c-1);b[0]=Math.min(0,Math.max(d,b[0]))}else b[0]=Math.min(0,Math.max(V*(1-c),b[0]));return b[1]=Math.min(0,Math.max(W*(1-c),b[1])),b}function Q(b){var c=.05;b<gb.zoomRange[0]+c?(a(gb.container+" .zoom-minus").addClass("inactive"),a(gb.container+" .zoom-plus").removeClass("inactive")):b>gb.zoomRange[1]-c?(a(gb.container+" .zoom-plus").addClass("inactive"),a(gb.container+" .zoom-minus").removeClass("inactive")):(a(gb.container+" .zoom-plus").removeClass("inactive"),a(gb.container+" .zoom-minus").removeClass("inactive"))}function R(){nb=!0}function S(a){return"undefined"!=typeof a}var T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb={selectedColor:"#FFE700",selectedStrokeColor:"#000000",strokeColor:"#CCC",strokeWidthMin:"0.07",strokeWidthMax:"0.3",colorRangeStart:"rgb(182,218,195)",colorRangeEnd:"rgb(7,84,37)",colorNoData:"#efefef",mapListColorNotLocatable:"#CCC"},gb={container:".geochart-map",zoomRange:[1,9],mapName:"ne_50m_admin_0_countries",hasDataClass:"hasData",fullscreenClass:"fullscreen",notLocatableTitle:"Not Locatable",thresholdToSmallMap:600,smallMapClass:"smallMap"},hb=[],ib=[{"data-type":"OBSERVED_PEERS","data-type-title":"Observed Peers",active:"active"},{"data-type":"MAX_SWARM_SIZE","data-type-title":"Max Swarm Size",active:""},{"data-type":"MAX_SWARM_SIZE2","data-type-title":"Max Swarm Size2",active:""},{"data-type":"MAX_SWARM_SIZE3","data-type-title":"Max Swarm Size3",active:""},{"data-type":"MAX_SWARM_SIZE4","data-type-title":"Max Swarm Size4",active:""},{"data-type":"MAX_SWARM_SIZE5","data-type-title":"Max Swarm Size5",active:""},{"data-type":"MAX_SWARM_SIZE6","data-type-title":"Max Swarm Size6",active:""},{"data-type":"MAX_SWARM_SIZE7","data-type-title":"Max Swarm Size7",active:""}],jb=b.scale.linear().range([0,1]),kb=b.scale.linear().domain(gb.zoomRange).range([fb.strokeWidthMax,fb.strokeWidthMin]),lb=0,mb=Math.log,nb=!1,ob={log:function(a){return Math.log(a)},linear:function(a){return a},quadratic:function(a){return Math.pow(a,2)},sqrt:function(a){return Math.sqrt(a)},cubicroot:function(a){return Math.pow(a,1/3)},neginverse:function(a){return-1/a+1}},pb={};return pb.hasPeerData=function(a){return"undefined"!=typeof a.properties.observedPeers},pb.getPercentageBetweenUpperAndLowerColor=function(a){var b=a.properties.observedPeers,c=mb(b);return jb(c)},pb.getColor=function(a){var c=pb.getPercentageBetweenUpperAndLowerColor(a),d=b.interpolateRgb(fb.colorRangeStart,fb.colorRangeEnd);return d(c)},pb.getStrokeColor=function(a){return b.rgb(pb.getColor(a)).darker().toString()},pb.isInFullscreen=function(){return a(gb.container).hasClass(gb.fullscreenClass)},{init:h,initWithoutControls:g,makeFixedSize:R}}(jQuery,d3,topojson,moment,geochartjs.utils,geochartjs.errorHandling);