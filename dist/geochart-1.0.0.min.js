var geochartjs=geochartjs||{};geochartjs.htmlTemplate=function(){"use strict";var a={};return a["overlays.tpl.html"]='<div class="spinner"></div><div class="overlay" style="opacity: 0"><div class="button show-slide-menu-button"><span class="icon icon-menu"><span class="inner"></span></span></div><div class="button zoom-plus"><div class="icon icon-plus"></div></div><div class="button zoom-minus"><div class="icon icon-minus"></div></div><div class="button settings"><div class="icon icon-settings"><div class="inner"></div></div><div class="icon icon-settings-hide"></div></div><div class="settingsWrapper"><div class="functionSelectWrapper"><div class="icon icon-select"></div><div class="selectLabel"></div><select class="button functionSelect"><option value="log"></option><option value="linear"></option><option value="quadratic"></option><option value="sqrt"></option><option value="cubicroot"></option><option value="neginverse"></option></select></div><div class="dataTypeSelectWrapper"><div class="icon icon-select"></div><div class="selectLabel"></div><select class="button dataTypeSelect"></select></div></div><div class="single-country-info"></div><div class="slide-menu"><div class="hide-slide-menu-area"></div><div class="listWrapper"><div class="menu"><h2><span class="title"></span><span class="date"></span></h2><div class="data-type-chooser"><div class="bottomLine"></div><div class="scroll-pane"></div><a class="left-scroll"></a> <a class="right-scroll"></a></div><div class="list"><a class="csvDownload" target="_blank"><span class="icon icon-download"><span class="inner"></span></span> <span>.csv</span></a><div class="scroll-pane"><table><tbody></tbody></table></div></div></div></div></div><div class="button fullscreen-open"><span class="icon icon-fullscreen-open"><span class="inner"></span></span></div><div class="button fullscreen-close"><span class="icon icon-fullscreen-close"><span class="inner"></span></span></div></div>',a["templates.tpl.html"]='<script type="text/html" id="single-country-info-template"><div> <span data-content="countryLabel"></span> <span data-content="continent" class="continent"></span> </div> <div class="data-type"> <span class="value" data-content="value"></span> <span class="percentage"><span data-content="percent"></span>%</span> <span class="title" data-content="dataType"></span> </div></script><script type="text/html" id="slide-menu-table-template"><tr data-template-bind=\'{"attribute": "data-country-code", "value": "code"}\'> <td> <span data-content="ranking" class="ranking"></span> </td> <td> <span data-content="label" class="countryName"></span> <span data-content="continent" class="continent"></td> </td> <td> <span class="percentage"> <span data-content="percent"></span>% </span> </td> <td> <span class="observedPeers" data-content="value"></span> </td> </tr></script><script type="text/html" id="data-type-chooser-template"><span class="tab" data-content="label" data-template-bind=\'[{ "attribute": "data-type", "value": "type" }]\'></span></script><script type="text/html" id="data-type-chooser-select-template"><option data-content="label" data-value="type"></option></script>',{overlays:a["overlays.tpl.html"],templates:a["templates.tpl.html"]}}(),geochartjs.utils=function(){"use strict";return{formatNumber:function(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,"'"),b.join(".")},retrieveGetArgumentsFromUrl:function(){for(var a=window.location.search.substr(1),b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("=");"undefined"!==e[0]&&null!==e[0]&&(c[e[0]]=e[1])}return c}}}(jQuery),geochartjs.errorHandling=function(a,b){"use strict";function c(){var a="No data received",b="While trying to get the data from the database, an error occured and no data was transferred to the webpage. Please reload this page again.";e(a,b)}function d(){var a="Error occured",b="An error occured during execution. Please reload this page.";e(a,b)}function e(a,b){var c=$("#globalError");c.find(".title").text(a),c.find(".message").text(b),c.fadeIn("fast")}"undefined"!=typeof a&&null!==a?a.hasOwnProperty("error")?a.error.hasOwnProperty("title")&&a.error.hasOwnProperty("message")?e(a.error.title,a.error.message):d():"undefined"!=typeof b&&b():c()},geochartjs.map=function(a,b,c,d,e,f){"use strict";function g(){a(f.overlays).appendTo(rb.container),a(f.templates).appendTo("body")}function h(){a(".slide-menu .menu h2 .title").text(wb.mapListTitle),a(".functionSelectWrapper .selectLabel").text(wb.configurationColorFunction),a(".dataTypeSelectWrapper .selectLabel").text(wb.configurationDataType),a(".button.functionSelect").find("option").text(function(){return wb.colorFunction[a(this).val()]})}function i(){var b=a(".list .csvDownload");cb(tb.csv)?b.attr("href",tb.csv):b.remove()}function j(){var b=d(tb.date.value,tb.date.format).format(ub.date);a(rb.container+" .slide-menu h2 .date").text("("+b+")")}function k(){function c(){b.event.defaultPrevented&&b.event.stopPropagation()}fb=b.select(rb.container).append("svg").style("background",vb.seaColor),jb=b.geo.equirectangular(),ab()?(ib=a(rb.container).height(),hb=2*ib,fb.attr({width:a(rb.container).width(),height:a(rb.container).height()}),jb.translate([hb/2,ib/2]).scale(hb/2/Math.PI)):(hb=a(rb.container).width(),ib=hb/2,fb.attr({width:hb,height:ib}),jb.translate([hb/2,ib/2]).scale(hb/2/Math.PI)),a(rb.container).removeClass(rb.smallMapClass),hb<rb.thresholdToSmallMap&&a(rb.container).addClass(rb.smallMapClass),kb=b.geo.path().projection(jb),lb=b.behavior.zoom().scaleExtent(rb.zoomRange).on("zoom",L),gb=fb.append("g").style("opacity",0),fb.call(lb).call(lb.event).on("click",c,!0),ob=a(window).width()}function l(){b.select(window).on("resize",function(){var c=a(rb.container).is("."+rb.fullscreenClass),d=ob!==a(window).width();Bb&&!c||!c&&!d||(ob=a(window).width(),window.clearTimeout(nb),b.select(rb.container+" .overlay").transition().duration(200).style("opacity",0),a(rb.container+" .single-country-info").hide(),m())})}function m(){nb=window.setTimeout(function(){n()},300)}function n(){fb.remove(),k(),K(void 0),B()}function o(){xb.domain([0,Ab(zb)])}function p(){zb=b.max(tb.countries,function(a){return cb(a.values[tb.selectedType])?parseFloat(a.values[tb.selectedType].percent,10):0})}function q(a){for(var b=0;b<tb.countries.length;b++)for(var c=!1,d=0;d<a.features.length;d++){var e=a.features[d].properties.iso_a2;if(tb.countries[b].code===e){var f=tb.countries[b];a.features[d].properties.country=f,c=!0}}return a}function r(){s(),t()}function s(){function a(a,b){var c=a.percent,d=b.percent;return c>d?-1:d>c?1:0}sb=[];for(var b=0;b<tb.countries.length;b++){var c=tb.countries[b];cb(c.values[tb.selectedType])&&sb.push({code:c.code,label:c.label,continent:c.continent,value:c.values[tb.selectedType].value,percent:c.values[tb.selectedType].percent})}sb.sort(a);for(var d=0;d<sb.length;d++)sb[d].ranking=d+1}function t(){var b=a(rb.container+" .slide-menu .list table tbody");b.empty(),b.loadTemplate(a("#slide-menu-table-template"),sb)}function u(){a(".data-type-chooser .scroll-pane").loadTemplate(a("#data-type-chooser-template"),tb.types).find("span")}function v(){a(".button.dataTypeSelect").change(function(){var b=a(this).find("option:selected").val();y(b)})}function w(){var b=a(".data-type-chooser .tab");b.click(function(){if(!a(this).hasClass("active")){var b=a(this).data("type");a(".button.dataTypeSelect").val(b),pb.scrollToX(a(this).position().left-30),y(b)}})}function x(){a(".button.dataTypeSelect").val(tb.selectedType),a(".data-type-chooser .tab[data-type="+tb.selectedType+"]").addClass("active")}function y(b){tb.selectedType=b,r(),A(),a(".single-country-info").fadeOut(),z()}function z(){p(),o(),gb.selectAll("path").style("fill",E).style("cursor",D).style("stroke",G).on("click",H),C()}function A(){qb=a(".data-type-chooser .tab[data-type="+tb.selectedType+"]");var b=a(".data-type-chooser .tab");b.removeClass("active"),b.filter("[data-type="+tb.selectedType+"]").addClass("active")}function B(){p(),o(),gb.selectAll("path").data(mb.features).enter().append("path").attr("d",kb).style("fill",E).style("stroke-width",vb.countryStrokeWidthMax+"px").style("stroke",G).style("cursor",D).on("click",H),C(),gb.transition().duration(700).style("opacity",1),a(".spinner").fadeOut("fast"),a(".overlay").fadeIn(700),b.select(rb.container+" .overlay").transition().duration(700).style("opacity",1)}function C(){gb.selectAll("path").each(function(b){if(!Y(b)){var c=a(this).parent()[0],d=a(c).children().first()[0];c.insertBefore(this,d)}})}function D(a){return Y(a)?"pointer":void 0}function E(a){if(Y(a)){var b=a.properties.country.code,c=$(a);return F(b,c),$(a)}return vb.countryColorNoData}function F(b,c){a(".slide-menu .list").find("table tr[data-country-code="+b+"]").find(".ranking").css("backgroundColor",c)}function G(a){return Y(a)?_(a):vb.countryStrokeColor}function H(a){var c=b.rgb(vb.selectedCountryColor).toString(),d=b.rgb(b.select(this).style("fill")).toString(),e=c===d;Y(a)&&!e&&(gb.selectAll("path").style("fill",E).style("stroke",G),b.select(this.parentNode.appendChild(this)).transition().style({fill:vb.selectedCountryColor,stroke:vb.selectedCountryStrokeColor}),I(a),K(a))}function I(b){var c=b.properties.country,d={countryLabel:c.label,continent:c.continent,dataType:J(tb.selectedType),percent:c.values[tb.selectedType].percent,value:c.values[tb.selectedType].value};a(".single-country-info").fadeIn(),a(".single-country-info").loadTemplate(a("#single-country-info-template"),d)}function J(a){for(var b=0;b<tb.types.length;b++)if(tb.types[b].type===a)return tb.types[b].label;return""}function K(b){var c=a(rb.container+" .slide-menu .list"),d=c.find("table tbody tr");if(d.removeClass("selected"),"undefined"!=typeof b){var e=b.properties.iso_a2;d.each(function(){a(this).data("country-code")===e&&a(this).addClass("selected")})}}function L(){b.event.scale<1&&(b.event.scale=1);var a=b.event.translate,c=b.event.scale;a=W(a,c),X(c),gb.selectAll("path").style("stroke-width",yb(c)+"px"),gb.attr("transform","translate("+a+")scale("+c+")")}function M(){function b(b){var c=!a(this).hasClass("inactive"),d=b.zoomIn===!0||b.zoomIn===!1;if(c&&d){var e=lb.scale(),f=lb.translate(),g=[f[0]-hb/2,f[1]-ib/2],h=Math.round(b.zoomIn?e+1:e-1),i=[g[0]/e*h,g[1]/e*h],j=[i[0]+hb/2,i[1]+ib/2];j=W(j,h),fb.transition().duration(100).call(h>=rb.zoomRange[0]&&h<=rb.zoomRange[1]?lb.scale(h).translate(j).event:h>rb.zoomRange[1]?lb.scale(rb.zoomRange[1]).translate(j).event:lb.scale(rb.zoomRange[0]).translate(j).event)}}a(rb.container+" .zoom-plus").click(function(){b.apply(this,[{zoomIn:!0}])}),a(rb.container+" .zoom-minus").click(function(){b.apply(this,[{zoomIn:!1}])})}function N(){a(rb.container+" .fullscreen-open").click(O),a(rb.container+" .fullscreen-close").click(P)}function O(){a(this).is(":not(:hidden)")&&(!function(a){var b=a[0];b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()}(a(rb.container)),a(rb.container).addClass(rb.fullscreenClass),a("html").css({overflow:"hidden"}),a(rb.container+" .single-country-info").fadeOut(),a(this).fadeOut(),a(rb.container+" .fullscreen-close").fadeIn(),S(),m())}function P(){a(this).is(":not(:hidden)")&&(!function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}(),a(rb.container).removeClass(rb.fullscreenClass),a("html").css({overflow:"visible"}),a(rb.container+" .single-country-info").fadeOut(),a(this).fadeOut(),a(rb.container+" .fullscreen-open").fadeIn(),m(),S())}function Q(){var b=a(rb.container+" .slide-menu .menu"),c=a(rb.container+" .show-slide-menu-button"),d=a(rb.container+" .hide-slide-menu-area");c.click(function(){b.animate({left:0}),c.fadeOut(),d.fadeIn(),"undefined"!=typeof qb&&pb.scrollToX(qb.position().left-30)}),d.click(function(){b.animate({left:-(b.outerWidth()+20)}),c.fadeIn(),d.fadeOut()})}function R(){a(".button.functionSelect").change(function(){Ab=Cb[a(this).find("option:selected").val()],a(".single-country-info").fadeOut(),z()})}function S(){a(".list .scroll-pane").jScrollPane({verticalDragMinHeight:70})}function T(){var b=a(".data-type-chooser"),c=b.find(".scroll-pane");pb=c.jScrollPane({showArrows:!0,animateScroll:!0,speed:200}).data("jsp"),A()}function U(){a(".button.settings").click(function(){var b=a(this).find(".icon-settings"),c=a(this).find(".icon-settings-hide");a(this).hasClass("shown")?(a(this).removeClass("shown"),a(this).animate({bottom:10},"fast"),a(".settingsWrapper").animate({bottom:-55},"fast"),c.fadeOut("fast"),b.fadeIn("fast")):(a(this).addClass("shown"),a(this).animate({bottom:50},"fast"),a(".settingsWrapper").animate({bottom:10},"fast"),c.fadeIn("fast"),b.fadeOut("fast"))})}function V(){a("select.dataTypeSelect").loadTemplate(a("#data-type-chooser-select-template"),tb.types)}function W(b,c){if(ab()){var d=(a(rb.container).width()-hb)*c-a(rb.container).width()*(c-1);b[0]=Math.min(0,Math.max(d,b[0]))}else b[0]=Math.min(0,Math.max(hb*(1-c),b[0]));return b[1]=Math.min(0,Math.max(ib*(1-c),b[1])),b}function X(b){var c=.05;b<rb.zoomRange[0]+c?(a(rb.container+" .zoom-minus").addClass("inactive"),a(rb.container+" .zoom-plus").removeClass("inactive")):b>rb.zoomRange[1]-c?(a(rb.container+" .zoom-plus").addClass("inactive"),a(rb.container+" .zoom-minus").removeClass("inactive")):(a(rb.container+" .zoom-plus").removeClass("inactive"),a(rb.container+" .zoom-minus").removeClass("inactive"))}function Y(a){return cb(a.properties.country)?cb(a.properties.country.values[tb.selectedType]):!1}function Z(a){var b=a.properties.country.values[tb.selectedType].percent,c=Ab(b);return xb(c)}function $(a){var c=Z(a),d=b.interpolateRgb(vb.countryColorRangeStart,vb.countryColorRangeEnd);return d(c)}function _(a){return b.rgb($(a)).darker().toString()}function ab(){return a(rb.container).hasClass(rb.fullscreenClass)}function bb(){Bb=!0}function cb(a){return"undefined"!=typeof a}function db(a){return typeof a===Object||"object"==typeof a}function eb(a){return typeof a===String||"string"==typeof a}var fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb={container:".geochart-map",zoomRange:[1,9],mapName:"ne_50m_admin_0_countries",hasDataClass:"hasData",fullscreenClass:"fullscreen",notLocatableTitle:"Not Locatable",thresholdToSmallMap:600,smallMapClass:"smallMap"},sb=[],tb=[],ub={date:"YYYY-MM-DD"},vb={seaColor:"#B8D5EA",countryColorRangeStart:"rgb(182,218,195)",countryColorRangeEnd:"rgb(7,84,37)",countryColorNoData:"#efefef",countryStrokeColor:"#CCC",countryStrokeWidthMin:"0.07",countryStrokeWidthMax:"0.3",selectedCountryColor:"#FFE700",selectedCountryStrokeColor:"#000000"},wb={mapListTitle:"Data Distribution",configurationDataType:"DATA TYPE",configurationColorFunction:"COLOR FUNCTION",colorFunction:{log:"Logarithmic",linear:"Linear",quadratic:"Quadratic",sqrt:"Square Root",cubicroot:"Cubic Root",neginverse:"Negated Inverse"}},xb=b.scale.linear().range([0,1]),yb=b.scale.linear().domain(rb.zoomRange).range([vb.countryStrokeWidthMax,vb.countryStrokeWidthMin]),zb=0,Ab=Math.log,Bb=!1,Cb={log:function(a){return Math.log(a)},linear:function(a){return a},quadratic:function(a){return Math.pow(a,2)},sqrt:function(a){return Math.sqrt(a)},cubicroot:function(a){return Math.pow(a,1/3)},neginverse:function(a){return-1/a+1}},Db=function(){function d(b){a(rb.container).addClass("noControls"),Db(b)}function e(c){function d(a){if(eb(c.data))b.json(c.data,function(b){tb=b.data,n(a)});else{if(!db(c.data))throw"'geochart.js' needs a valid data object";tb=c.data,n(a)}}f(),db(c.format)&&(ub=a.extend(!0,ub,c.format)),db(c.style)&&(vb=a.extend(!0,vb,c.style)),db(c.label)&&(wb=a.extend(!0,wb,c.label)),m(),function(){if(eb(c.map))b.json(c.map,function(a){d(a)});else{if(!db(c.map))throw"'geochart.js' needs a valid input map";d(c.map)}}(),o()}function f(){function b(a){if(!cb(a.lib))throw"LibraryMissingError: "+a.name+" is missing."}b({lib:a(document).loadTemplate,name:"jQuery loadTemplate"}),b({lib:a(document).jScrollPane,name:"jQuery jScrollPane"})}function m(){g(),h(),k(),l()}function n(a){mb=c.feature(a,a.objects[rb.mapName]),function(){i(),j()}(),function(){r(),S()}(),function(){u(),T(),V(),x(),w()}(),function(){mb=q(mb),B()}()}function o(){M(),N(),Q(),U(),R(),v()}return{init:e,initNoControls:d}}();return{init:Db.init,initNoControls:Db.initNoControls,makeFixedSize:bb}}(jQuery,d3,topojson,moment,geochartjs.utils,geochartjs.htmlTemplate);