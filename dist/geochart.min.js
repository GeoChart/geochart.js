!function(a,b,c,d,e){"use strict";function f(a){if(!oa(a))throw ga(),"geochart needs a valid configuration input";pa(a.bindTo)&&(Wa=a.bindTo),function(){if(1===b(Wa).length)b(Wa).empty(),Ha=b('<div class="'+Na.container+'">').appendTo(b(Wa)),Ga=c.select(Wa).select("."+Na.container);else{if(0!==b(Wa).length)throw ga(),"geochart needs exactly one element to bind to";Ha=b("<div></div>").addClass(Na.container);var a;a="."===Wa.charAt(0)?b("<div></div>").addClass(Wa.substr(1)):"#"===Wa.charAt(0)?b("<div></div>").attr("id",Wa.substr(1)):b("<div></div>").attr("id",Wa),Ha.appendTo(a),a.appendTo("body"),Ga=c.select(Wa).select("."+Na.container)}}(),oa(a.format)&&(Ja=b.extend(!0,Ja,a.format)),oa(a.style)&&(Ka=b.extend(!0,Ka,a.style)),oa(a.label)&&(La=b.extend(!0,La,a.label)),oa(a.properties)&&(Ma=b.extend(!0,Ma,a.properties),Ma.fullscreen||Ha.addClass(Na.noFullscreen),Ma.noControls.inGeneral&&Ha.addClass(Na.noControls))}function g(){b(ta["overlays.tpl"]).appendTo(Ha),b(ta["templates.tpl"]).appendTo(b(Wa))}function h(){Ha.find(".slide-menu .gc-title .value").text(La.mapListTitle),Ha.find(".gc-color-function-select-wrapper .selectLabel").text(La.configurationColorFunction),Ha.find(".gc-data-type-select-wrapper .selectLabel").text(La.configurationDataType),Ha.find(".gc-button.gc-color-function-select").find("option").text(function(){return La.colorFunction[b(this).val()]})}function i(){var a;for(var b in Ia.countries)if(Ia.countries.hasOwnProperty(b)&&na(Ia.countries[b].values))for(a in Ia.countries[b].values)Ia.countries[b].values.hasOwnProperty(a)&&na(Ia.countries[b].values[a])&&(Ia.countries[b].values[a]=parseFloat(Ia.countries[b].values[a]));if(a=void 0,na(Ia.notLocatable)&&na(Ia.notLocatable.values))for(a in Ia.notLocatable.values)Ia.notLocatable.values.hasOwnProperty(a)&&(Ia.notLocatable.values[a]=parseFloat(Ia.notLocatable.values[a]))}function j(){function a(a){for(var b=0;b<Ia.types.length;b++)if(Ia.types[b].type===a)return void Ia.types.splice(b,1)}for(var b={},c=0;c<Ia.types.length;c++)b[Ia.types[c].type]=!1;for(var d in Ia.countries)if(Ia.countries.hasOwnProperty(d))for(var e in Ia.countries[d].values)Ia.countries[d].values.hasOwnProperty(e)&&(b[e]=!0);for(var f in b)b.hasOwnProperty(f)&&(b[f]||a(f))}function k(){if(pa(Ia.selectedType)){for(var a=!1,b=0;b<Ia.types.length;b++)if(Ia.selectedType===Ia.types[b].type){a=!0;break}a||(Ia.selectedType=Ia.types[0].type)}else Ia.selectedType=Ia.types[0].type}function l(){for(var a in Ia.countries)Ia.countries.hasOwnProperty(a)&&(na(Ia.countries[a].values)||(Ia.countries[a].values={}))}function m(){var a=Ha.find(".gc-list .csvDownload");na(Ia.csv)?a.attr("href",Ia.csv):a.remove()}function n(){function a(){Ha.find(".slide-menu .gc-title .date").text("("+b+")")}var b;pa(Ia.date)?(b=e(Ia.date).format(Ja.date),a()):oa(Ia.date)&&(b=e(Ia.date.value,Ia.date.format).format(Ja.date),a())}function o(){function a(){c.event.defaultPrevented&&c.event.stopPropagation()}ua=Ga.append("svg"),ua.style("background",Ka.seaColor),Ha.css("background",Ka.seaColor),ya=c.geo.equirectangular(),la()?(xa=Ha.height(),wa=2*xa,ua.attr({width:Ha.width(),height:Ha.height()}),ya.translate([wa/2,xa/2]).scale(wa/2/Math.PI)):(wa=Ha.width(),xa=wa/2,ua.attr({width:wa,height:xa}),ya.translate([wa/2,xa/2]).scale(wa/2/Math.PI)),Ha.removeClass(Na.smallMap),Ma.noControls.inSmallMap&&wa<Ma.noControls.smallMapThreshold&&Ha.addClass(Na.smallMap),za=c.geo.path().projection(ya),Aa=c.behavior.zoom().scaleExtent(Ma.zoomRange).on("zoom",R),va=ua.append("g").style("opacity",0),ua.call(Aa).call(Aa.event).on("click",a,!0)}function p(){Fa=Ha.width(),c.select(a).on("resize",function(){var b=Fa!==Ha.width();Va&&!la()||!la()&&!b||(Fa=Ha.width(),a.clearTimeout(Ca),Ga.select(".gc-overlay").transition().duration(200).style("opacity",0),Ha.find(".gc-single-country-info").hide(),q())})}function q(){U(),Ca=a.setTimeout(function(){r(),$()},300)}function r(){ua.remove(),o(),Q(void 0),G()}function s(){Qa.domain([0,Ua(Sa)])}function t(){var a=ra();Ta=0,Sa=c.max(a,function(a){if(na(a.values[Ia.selectedType])){var b=parseFloat(a.values[Ia.selectedType]);return Ta+=b,b}return 0})}function u(a){for(var b=ra(),c=0;c<b.length;c++)for(var d=!1,e=0;e<a.features.length;e++){var f=a.features[e].properties.iso_a2;if(b[c].code===f){var g=b[c];a.features[e].properties.country=g,d=!0}}return a}function v(){w(),y()}function w(){function a(a,b){var c=a.value,d=b.value;return c>d?-1:d>c?1:0}Pa=[];for(var b=ra(),c=0;c<b.length;c++){var d=b[c];na(d.values[Ia.selectedType])&&Pa.push({code:d.code,label:na(d.label)&&!qa(d.label)?d.label:d.code,continent:d.continent,value:d.values[Ia.selectedType],percent:x(d.values[Ia.selectedType]/Ta),displayContinent:!na(d.continent)||qa(d.continent)?"display:none":"",unit:O()})}!function(){na(Ia.notLocatable)&&na(Ia.notLocatable.values)&&na(Ia.notLocatable.values[Ia.selectedType])&&Pa.push({code:"&nbsp;",label:Ia.notLocatable.label,value:Ia.notLocatable.values[Ia.selectedType],percent:x(Ia.notLocatable.values[Ia.selectedType]/Ta),displayContinent:"display:none"})}(),Pa.sort(a);for(var e=0;e<Pa.length;e++)Pa[e].ranking=e+1}function x(a){return(Math.round(100*a*1e3)/1e3).toFixed(3)+"%"}function y(){var a=Ha.find(".slide-menu .gc-list table tbody");a.empty(),a.loadTemplate(b("#gc-slide-menu-table-template"),Pa)}function z(){Ha.find(".gc-data-type-chooser .gc-scroll-pane").loadTemplate(b("#gc-data-type-chooser-template"),Ia.types)}function A(){Ha.find(".gc-button.gc-data-type-select").change(function(){var a=b(this).find("option:selected").val();D(a)})}function B(){var a=Ha.find(".gc-data-type-chooser .tab");a.click(function(){if(!b(this).hasClass(Na.activeTab)){var a=b(this).data("type");Ha.find(".gc-button.gc-data-type-select").val(a),Da.scrollToX(b(this).position().left-30),D(a)}})}function C(){Ha.find(".gc-button.gc-data-type-select").val(Ia.selectedType),Ha.find(".gc-data-type-chooser .tab[data-type="+Ia.selectedType+"]").addClass(Na.activeTab)}function D(a){Ia.selectedType=a,Z(),F(),Ha.find(".gc-single-country-info").fadeOut(),v(),E()}function E(){va.selectAll("path").style("fill",J).style("cursor",I).style("stroke",L).on("click",M),H()}function F(){Ea=Ha.find(".gc-data-type-chooser .tab[data-type="+Ia.selectedType+"]");var a=Ha.find(".gc-data-type-chooser .tab");a.removeClass(Na.activeTab),a.filter("[data-type="+Ia.selectedType+"]").addClass(Na.activeTab)}function G(){va.selectAll("path").data(Ba.features).enter().append("path").attr("d",za).style("fill",J).style("stroke-width",Ka.countryStrokeWidthMax+"px").style("stroke",L).style("cursor",I).on("click",M),H(),va.transition().duration(700).style("opacity",1),Ha.find(".gc-spinner").fadeOut("fast"),Ha.find(".gc-overlay").fadeIn(700),Ga.select(".gc-overlay").transition().duration(700).style("opacity",1)}function H(){va.selectAll("path").each(function(a){if(!ha(a)){var c=b(this).parent()[0],d=b(c).children().first()[0];c.insertBefore(this,d)}})}function I(a){return ha(a)?"pointer":void 0}function J(a){if(ha(a)){var b=a.properties.country.code,c=ja(a);return K(b,c),ja(a)}return Ka.countryColorNoData}function K(a,b){Ha.find(".slide-menu .gc-list").find("table tr[data-country-code="+a+"]").find(".ranking").css("backgroundColor",b)}function L(a){return ha(a)?ka(a):Ka.countryStrokeColor}function M(a){var b=c.rgb(Ka.selectedCountryColor).toString(),d=c.rgb(c.select(this).style("fill")).toString(),e=b===d;ha(a)&&!e&&(va.selectAll("path").style("fill",J).style("stroke",L),c.select(this.parentNode.appendChild(this)).transition().style({fill:Ka.selectedCountryColor,stroke:Ka.selectedCountryStrokeColor}),N(a),Q(a))}function N(a){var c=a.properties.country,d={countryLabel:na(c.label)&&!qa(c.label)?c.label:c.code,continent:c.continent,dataType:P(Ia.selectedType),value:c.values[Ia.selectedType],percent:x(c.values[Ia.selectedType]/Ta),unit:O()};Ha.find(".gc-single-country-info").fadeIn(),Ha.find(".gc-single-country-info").loadTemplate(b("#gc-single-country-info-template"),d)}function O(){for(var a=0;a<Ia.types.length;a++)if(Ia.types[a].type===Ia.selectedType)return pa(Ia.types[a].unit)?Ia.types[a].unit:"";return""}function P(a){for(var b=0;b<Ia.types.length;b++)if(Ia.types[b].type===a)return Ia.types[b].label;return""}function Q(a){var c=Ha.find(".slide-menu .gc-list"),d=c.find("table tbody tr");if(d.removeClass(Na.selectedCountryInMapList),na(a)){var e=a.properties.iso_a2;d.each(function(){b(this).data("country-code")===e&&(b(this).addClass(Na.selectedCountryInMapList),b(this).find(".ranking").css("backgroundColor",Ka.selectedCountryColor))})}}function R(){c.event.scale<1&&(c.event.scale=1);var a=c.event.translate,b=c.event.scale;a=ca(a,b),da(b),va.selectAll("path").style("stroke-width",Ra(b)+"px"),va.attr("transform","translate("+a+")scale("+b+")"),Aa.translate(a),Aa.scale(b)}function S(){function a(a){var c=!b(this).hasClass(Na.inactiveOverlayButton),d=a.zoomIn===!0||a.zoomIn===!1;if(c&&d){var e=Aa.scale(),f=Aa.translate(),g=[f[0]-wa/2,f[1]-xa/2],h=Math.round(a.zoomIn?e+1:e-1),i=[g[0]/e*h,g[1]/e*h],j=[i[0]+wa/2,i[1]+xa/2];j=ca(j,h),ua.transition().duration(100).call(h>=Ma.zoomRange[0]&&h<=Ma.zoomRange[1]?Aa.scale(h).translate(j).event:h>Ma.zoomRange[1]?Aa.scale(Ma.zoomRange[1]).translate(j).event:Aa.scale(Ma.zoomRange[0]).translate(j).event)}}Ha.find(".gc-zoom-plus").click(function(){a.apply(this,[{zoomIn:!0}])}),Ha.find(".gc-zoom-minus").click(function(){a.apply(this,[{zoomIn:!1}])})}function T(){Ha.find(".gc-fullscreen-open").click(V),Ha.find(".gc-fullscreen-close").click(W)}function U(){Ha.find(".gc-spinner").show(),Ha.find("svg > g").hide()}function V(){b(this).is(":not(:hidden)")&&(!function(a){var b=a[0];b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()}(Ha),Ma.fullscreen&&Ha.addClass(Na.fullscreen),b("html").css({overflow:"hidden"}),Ha.find(".gc-single-country-info").fadeOut(),b(this).fadeOut(),Ha.find(".gc-fullscreen-close").fadeIn(),q())}function W(){b(this).is(":not(:hidden)")&&(!function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}(),Ma.fullscreen&&Ha.removeClass(Na.fullscreen),b("html").css({overflow:"visible"}),Ha.find(".gc-single-country-info").fadeOut(),b(this).fadeOut(),Ha.find(".gc-fullscreen-open").fadeIn(),q(),$())}function X(){var a=Ha.find(".slide-menu .menu"),b=Ha.find(".gc-button.gc-show-slide-menu"),c=Ha.find(".hide-slide-menu-area");b.click(function(){a.animate({left:0}),b.fadeOut(),c.fadeIn(),"undefined"!=typeof Ea&&Da.scrollToX(Ea.position().left-30)}),c.click(function(){a.animate({left:-(a.outerWidth()+20)}),b.fadeIn(),c.fadeOut()})}function Y(){Ha.find(".gc-button.gc-color-function-select").change(function(){Ua=Oa[b(this).find("option:selected").val()],Ha.find(".gc-single-country-info").fadeOut(),Ha.find(".slide-menu .gc-list").find("tr").removeClass("selected").find(".ranking").removeAttr("style"),Z(),E()})}function Z(){t(),s()}function $(){Ha.find(".gc-list .gc-scroll-pane").jScrollPane({verticalDragMinHeight:70})}function _(){var a=Ha.find(".gc-data-type-chooser"),b=a.find(".gc-scroll-pane");Da=b.jScrollPane({showArrows:!0,animateScroll:!0,speed:200}).data("jsp"),F()}function aa(){Ha.find(".gc-button.gc-settings").click(function(){var a=b(this).find(".gc-icon-settings"),c=b(this).find(".gc-icon-settings-hide");b(this).hasClass(Na.settingsShown)?(b(this).removeClass(Na.settingsShown),b(this).animate({bottom:10},"fast"),Ha.find(".gc-settings-wrapper").animate({bottom:-55},"fast"),c.fadeOut("fast"),a.fadeIn("fast")):(b(this).addClass(Na.settingsShown),b(this).animate({bottom:50},"fast"),Ha.find(".gc-settings-wrapper").animate({bottom:10},"fast"),c.fadeIn("fast"),a.fadeOut("fast"))})}function ba(){Ha.find("select.gc-data-type-select").loadTemplate(b("#gc-data-type-chooser-select-template"),Ia.types)}function ca(a,b){if(la()){var c=(Ha.width()-wa)*b-Ha.width()*(b-1);a[0]=Math.min(0,Math.max(c,a[0]))}else a[0]=Math.min(0,Math.max(wa*(1-b),a[0]));return a[1]=Math.min(0,Math.max(xa*(1-b),a[1])),a}function da(a){var b=.05;a<Ma.zoomRange[0]+b?(Ha.find(".gc-zoom-minus").addClass(Na.inactiveOverlayButton),Ha.find(".gc-zoom-plus").removeClass(Na.inactiveOverlayButton)):a>Ma.zoomRange[1]-b?(Ha.find(".gc-zoom-plus").addClass(Na.inactiveOverlayButton),Ha.find(".gc-zoom-minus").removeClass(Na.inactiveOverlayButton)):(Ha.find(".gc-zoom-plus").removeClass(Na.inactiveOverlayButton),Ha.find(".gc-zoom-minus").removeClass(Na.inactiveOverlayButton))}function ea(a){return Xa.init(a),fa()}function fa(){return{destroy:ga}}function ga(){b(Wa).empty().removeAttr("class").removeAttr("style")}function ha(a){return na(a.properties.country)?na(a.properties.country.values[Ia.selectedType]):!1}function ia(a){var b=a.properties.country.values[Ia.selectedType],c=Ua(b);return Qa(c)}function ja(a){var b=ia(a),d=c.interpolateRgb(Ka.countryColorRangeStart,Ka.countryColorRangeEnd);return d(b)}function ka(a){return c.rgb(ja(a)).darker().toString()}function la(){return Ha.hasClass(Na.fullscreen)}function ma(){Va=!0}function na(a){return"undefined"!=typeof a&&null!==a}function oa(a){return na(a)&&(typeof a===Object||"object"==typeof a)}function pa(a){return na(a)&&(typeof a===String||"string"==typeof a)}function qa(a){return pa(a)&&""===a}function ra(){var a=[];for(var c in Ia.countries)if(Ia.countries.hasOwnProperty(c)){var d=Ia.countries[c];a.push(b.extend(!0,{},d,{code:c}))}return a}var sa="0.0.1",ta={};ta["overlays.tpl"]='<div class="gc-spinner"></div><div class="gc-overlay"><div class="gc-button gc-show-slide-menu"><span class="gc-icon gc-icon-menu"><span class="gc-inner"></span></span></div><div class="gc-button gc-zoom-plus"><div class="gc-icon gc-icon-plus"></div></div><div class="gc-button gc-zoom-minus"><div class="gc-icon gc-icon-minus"></div></div><div class="gc-button gc-settings"><div class="gc-icon gc-icon-settings"><div class="gc-inner"></div></div><div class="gc-icon gc-icon-settings-hide"></div></div><div class="gc-settings-wrapper"><div class="gc-color-function-select-wrapper"><div class="gc-icon gc-icon-select"></div><div class="selectLabel"></div><select class="gc-button gc-color-function-select"><option value="log"></option><option value="linear"></option><option value="quadratic"></option><option value="sqrt"></option><option value="cubicroot"></option></select></div><div class="gc-data-type-select-wrapper"><div class="gc-icon gc-icon-select"></div><div class="selectLabel"></div><select class="gc-button gc-data-type-select"></select></div></div><div class="gc-single-country-info"></div><div class="slide-menu"><div class="hide-slide-menu-area"></div><div class="listWrapper"><div class="menu"><div class="gc-title"><span class="value"></span><span class="date"></span></div><div class="gc-data-type-chooser"><div class="bottomLine"></div><div class="gc-scroll-pane"></div><a class="left-scroll"></a> <a class="right-scroll"></a></div><div class="gc-list"><a class="csvDownload" target="_blank"><span class="gc-icon gc-icon-download"><span class="gc-inner"></span></span> <span>.csv</span></a><div class="gc-scroll-pane"><table><tbody></tbody></table></div></div></div></div></div><div class="gc-button gc-fullscreen-open"><span class="gc-icon gc-icon-fullscreen-open"><span class="gc-inner"></span></span></div><div class="gc-button gc-fullscreen-close"><span class="gc-icon gc-icon-fullscreen-close"><span class="gc-inner"></span></span></div></div>',ta["templates.tpl"]='<script type="text/html" id="gc-single-country-info-template"><div> <span data-content="countryLabel"></span> <span data-content="continent" class="continent"></span> </div> <div class="data-type"> <span class="value"> <span data-content="value"></span><span data-content="unit"></span> </span> <span class="percent" data-content="percent"></span> <span class="title" data-content="dataType"></span> </div></script><script type="text/html" id="gc-slide-menu-table-template"><tr data-template-bind=\'{"attribute": "data-country-code", "value": "code"}\'> <td> <span data-content="ranking" class="ranking"></span> </td> <td> <span data-content="label" class="countryName"></span> <span data-content="continent" class="continent" data-template-bind=\'{ "attribute": "style", "value": "displayContinent" }\'></span> </td> <td> <span class="percent" data-content="percent"></span> </td> <td> <span data-content="value"></span><span data-content="unit"></span> </td> </tr></script><script type="text/html" id="gc-data-type-chooser-template"><span class="tab" data-content="label" data-template-bind=\'[{ "attribute": "data-type", "value": "type" }]\'></span></script><script type="text/html" id="gc-data-type-chooser-select-template"><option data-content="label" data-value="type"></option></script>';var ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia={},Ja={date:"YYYY-MM-DD"},Ka={seaColor:"#B8D5EA",countryColorRangeStart:"rgb(182,218,195)",countryColorRangeEnd:"rgb(7,84,37)",countryColorNoData:"#efefef",countryStrokeColor:"#CCC",countryStrokeWidthMin:"0.07",countryStrokeWidthMax:"0.3",selectedCountryColor:"#FFE700",selectedCountryStrokeColor:"#000000"},La={mapListTitle:"Data Distribution",configurationDataType:"DATA TYPE",configurationColorFunction:"COLOR FUNCTION",colorFunction:{log:"Logarithmic",linear:"Linear",quadratic:"Quadratic",sqrt:"Square Root",cubicroot:"Cubic Root"}},Ma={mapName:"geochart-world-map",zoomRange:[1,9],fullscreen:!0,noControls:{inGeneral:!1,inSmallMap:!0,smallMapThreshold:600}},Na={container:"gc-map-wrapper",fullscreen:"fullscreen",noFullscreen:"no-fullscreen",smallMap:"smallMap",noControls:"noControls",activeTab:"active",selectedCountryInMapList:"selected",inactiveOverlayButton:"gc-inactive",settingsShown:"shown"},Oa={log:function(a){return Math.log(a)},linear:function(a){return a},quadratic:function(a){return Math.pow(a,2)},sqrt:function(a){return Math.sqrt(a)},cubicroot:function(a){return Math.pow(a,1/3)}},Pa=[],Qa=c.scale.linear().range([0,1]),Ra=c.scale.linear().domain(Ma.zoomRange).range([Ka.countryStrokeWidthMax,Ka.countryStrokeWidthMin]),Sa=0,Ta=0,Ua=Math.log,Va=!1,Wa="#geochart-map",Xa=function(){function a(a){function b(b){if(pa(a.data))c.json(a.data,function(a){if(!oa(a))throw ga(),"geochart needs a valid data object";a.hasOwnProperty("data")?Ia=a.data:oa(a)&&(Ia=a),r(b)});else{if(!oa(a.data))throw ga(),"geochart needs a valid data object";Ia=a.data,r(b)}}e(),q(a),function(){if(pa(a.map))c.json(a.map,function(a){b(a)});else{if(!oa(a.map))throw ga(),"geochart needs a valid input map";b(a.map)}}(),s()}function e(){function a(a){if(!na(a.lib))throw ga(),"geochart needs the library "+a.name}a({lib:b(document).loadTemplate,name:"jQuery loadTemplate"}),a({lib:b(document).jScrollPane,name:"jQuery jScrollPane"})}function q(a){f(a),g(),h(),o(),p()}function r(a){if(!na(a.objects[Ma.mapName]))throw ga(),"geochart needs a valid map as input. you probably did not set the TopoJSON mapName correctly.";Ba=d.feature(a,a.objects[Ma.mapName]),j(),k(),l(),i(),function(){m(),n()}(),function(){Z(),v(),$()}(),function(){z(),_(),ba(),C(),B()}(),function(){Ba=u(Ba),G()}()}function s(){S(),T(),X(),aa(),Y(),A()}return{init:a}}();a.geochart={version:sa,generate:ea,makeFixedSize:ma}}(window,jQuery,d3,topojson,moment);