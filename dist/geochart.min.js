!function(a,b,c,d,e){"use strict";function f(a){if(!qa(a))throw ja(),"geochart needs a valid configuration input";ra(a.bindTo)&&(Xa=a.bindTo),function(){if(1===b(Xa).length)b(Xa).empty(),Ja=b('<div class="'+Pa.container+'">').appendTo(b(Xa)),Ia=c.select(Xa).select("."+Pa.container);else{if(0!==b(Xa).length)throw ja(),"geochart needs exactly one element to bind to";Ja=b("<div></div>").addClass(Pa.container);var a;a="."===Xa.charAt(0)?b("<div></div>").addClass(Xa.substr(1)):"#"===Xa.charAt(0)?b("<div></div>").attr("id",Xa.substr(1)):b("<div></div>").attr("id",Xa),Ja.appendTo(a),a.appendTo("body"),Ia=c.select(Xa).select("."+Pa.container)}}(),qa(a.format)&&(La=b.extend(!0,La,a.format)),qa(a.style)&&(Ma=b.extend(!0,Ma,a.style)),qa(a.label)&&(Na=b.extend(!0,Na,a.label)),qa(a.properties)&&(Oa=b.extend(!0,Oa,a.properties),Oa.fullscreen||Ja.addClass(Pa.noFullscreen),Oa.noControls.inGeneral&&Ja.addClass(Pa.noControls))}function g(){b(va["overlays.tpl"]).appendTo(Ja),b(va["templates.tpl"]).appendTo(b(Xa))}function h(){Ja.find(".gc-slide-menu .gc-title .gc-value").text(Na.mapListTitle),Ja.find(".gc-color-function-select-wrapper .gc-select-label").text(Na.configurationColorFunction),Ja.find(".gc-data-type-select-wrapper .gc-select-label").text(Na.configurationDataType),Ja.find(".gc-button.gc-color-function-select").find("option").text(function(){return Na.colorFunction[b(this).val()]})}function i(){var a;for(var b in Ka.countries)if(Ka.countries.hasOwnProperty(b)&&pa(Ka.countries[b].values))for(a in Ka.countries[b].values)Ka.countries[b].values.hasOwnProperty(a)&&pa(Ka.countries[b].values[a])&&(Ka.countries[b].values[a]=parseFloat(Ka.countries[b].values[a]));if(a=void 0,pa(Ka.notLocatable)&&pa(Ka.notLocatable.values))for(a in Ka.notLocatable.values)Ka.notLocatable.values.hasOwnProperty(a)&&(Ka.notLocatable.values[a]=parseFloat(Ka.notLocatable.values[a]))}function j(){pa(Ka.maxTypeLabelLength)||(Ka.maxTypeLabelLength=20)}function k(){for(var a=0;a<Ka.types.length;a++)Ka.types[a].label.length>Ka.maxTypeLabelLength&&0!==Ka.maxTypeLabelLength&&(Ka.types[a].label=Ka.types[a].label.substr(0,Ka.maxTypeLabelLength)+"...")}function l(){function a(a){for(var b=0;b<Ka.types.length;b++)if(Ka.types[b].type===a)return void Ka.types.splice(b,1)}for(var b={},c=0;c<Ka.types.length;c++)b[Ka.types[c].type]=!1;for(var d in Ka.countries)if(Ka.countries.hasOwnProperty(d))for(var e in Ka.countries[d].values)Ka.countries[d].values.hasOwnProperty(e)&&(b[e]=!0);for(var f in b)b.hasOwnProperty(f)&&(b[f]||a(f))}function m(){if(ra(Ka.selectedType)){for(var a=!1,b=0;b<Ka.types.length;b++)if(Ka.selectedType===Ka.types[b].type){a=!0;break}a||(Ka.selectedType=Ka.types[0].type)}else Ka.selectedType=Ka.types[0].type}function n(){for(var a in Ka.countries)Ka.countries.hasOwnProperty(a)&&(pa(Ka.countries[a].values)||(Ka.countries[a].values={}))}function o(){var a=Ja.find(".gc-list .gc-csv-download");pa(Ka.csv)?a.attr("href",Ka.csv):a.remove()}function p(){function a(){Ja.find(".gc-slide-menu .gc-title .gc-date").text("("+b+")")}var b;ra(Ka.date)?(b=e(Ka.date).format(La.date),a()):qa(Ka.date)&&(b=e(Ka.date.value,Ka.date.format).format(La.date),a())}function q(){function a(){c.event.defaultPrevented&&c.event.stopPropagation()}wa=Ia.append("svg"),wa.style("background",Ma.seaColor),Ja.css("background",Ma.seaColor),Aa=c.geo.equirectangular(),oa()?(za=Ja.height(),ya=2*za,wa.attr({width:Ja.width(),height:Ja.height()}),Aa.translate([ya/2,za/2]).scale(ya/2/Math.PI)):(ya=Ja.width(),za=ya/2,wa.attr({width:ya,height:za}),Aa.translate([ya/2,za/2]).scale(ya/2/Math.PI)),Ja.removeClass(Pa.smallMap),Oa.noControls.inSmallMap&&ya<Oa.noControls.smallMapThreshold&&Ja.addClass(Pa.smallMap),Ba=c.geo.path().projection(Aa),Ca=c.behavior.zoom().scaleExtent(Oa.zoomRange).on("zoom",T),xa=wa.append("g").style("opacity",0),wa.call(Ca).call(Ca.event).on("click",a,!0)}function r(){Ha=Ja.width(),c.select(a).on("resize",function(){var b=Ha!==Ja.width();(oa()||b)&&(Ha=Ja.width(),a.clearTimeout(Ea),Ia.select(".gc-overlay").transition().duration(200).style("opacity",0),Ja.find(".gc-single-country-info").hide(),s())})}function s(){W(),Ea=a.setTimeout(function(){t(),aa()},300)}function t(){wa.remove(),q(),S(void 0),I()}function u(){Sa.domain([0,Wa(Ua)])}function v(){var a=ta();Va=0,Ua=c.max(a,function(a){if(pa(a.values[Ka.selectedType])){var b=parseFloat(a.values[Ka.selectedType]);return Va+=b,b}return 0})}function w(a){for(var b=ta(),c=0;c<b.length;c++)for(var d=!1,e=0;e<a.features.length;e++){var f=a.features[e].properties.iso_a2;if(b[c].code===f){var g=b[c];a.features[e].properties.country=g,d=!0}}return a}function x(){y(),A()}function y(){function a(a,b){var c=a.value,d=b.value;return c>d?-1:d>c?1:0}Ra=[];for(var b=ta(),c=0;c<b.length;c++){var d=b[c];pa(d.values[Ka.selectedType])&&Ra.push({code:d.code,label:pa(d.label)&&!sa(d.label)?d.label:d.code,continent:d.continent,value:d.values[Ka.selectedType],percent:z(d.values[Ka.selectedType]/Va),displayContinent:!pa(d.continent)||sa(d.continent)?"display:none":"",unit:Q()})}!function(){pa(Ka.notLocatable)&&pa(Ka.notLocatable.values)&&pa(Ka.notLocatable.values[Ka.selectedType])&&Ra.push({code:"&nbsp;",label:Ka.notLocatable.label,value:Ka.notLocatable.values[Ka.selectedType],percent:z(Ka.notLocatable.values[Ka.selectedType]/Va),displayContinent:"display:none"})}(),Ra.sort(a);for(var e=0;e<Ra.length;e++)Ra[e].ranking=e+1}function z(a){return(Math.round(100*a*1e3)/1e3).toFixed(3)+"%"}function A(){var a=Ja.find(".gc-slide-menu .gc-list table tbody");a.empty(),a.loadTemplate(b("#gc-slide-menu-table-template"),Ra)}function B(){Ja.find(".gc-data-type-chooser .gc-scroll-pane").loadTemplate(b("#gc-data-type-chooser-template"),Ka.types)}function C(){Ja.find(".gc-button.gc-data-type-select").change(function(){var a=b(this).find("option:selected").val();F(a)})}function D(){var a=Ja.find(".gc-data-type-chooser .gc-tab");a.click(function(){if(!b(this).hasClass(Pa.activeTab)){var a=b(this).data("type");Ja.find(".gc-button.gc-data-type-select").val(a),Fa.scrollToX(b(this).position().left-30),F(a)}})}function E(){Ja.find(".gc-button.gc-data-type-select").val(Ka.selectedType),Ja.find(".gc-data-type-chooser .gc-tab[data-type="+Ka.selectedType+"]").addClass(Pa.activeTab)}function F(a){Ka.selectedType=a,_(),H(),Ja.find(".gc-single-country-info").fadeOut(),x(),G()}function G(){xa.selectAll("path").transition(150).style("fill",L).style("cursor",K).style("stroke",N).on("click",O),J()}function H(){Ga=Ja.find(".gc-data-type-chooser .gc-tab[data-type="+Ka.selectedType+"]");var a=Ja.find(".gc-data-type-chooser .gc-tab");a.removeClass(Pa.activeTab),a.filter("[data-type="+Ka.selectedType+"]").addClass(Pa.activeTab)}function I(){xa.selectAll("path").data(Da.features).enter().append("path").attr("d",Ba).style("fill",L).style("stroke-width",Ma.countryStrokeWidthMax+"px").style("stroke",N).style("cursor",K).on("click",O),J(),xa.transition().duration(700).style("opacity",1),Ja.find(".gc-spinner").fadeOut("fast"),Ja.find(".gc-overlay").fadeIn(700),Ia.select(".gc-overlay").transition().duration(700).style("opacity",1)}function J(){xa.selectAll("path").each(function(a){if(!ka(a)){var c=b(this).parent()[0],d=b(c).children().first()[0];c.insertBefore(this,d)}})}function K(a){return ka(a)?"pointer":void 0}function L(a){if(ka(a)){var b=a.properties.country.code,c=ma(a);return M(b,c),ma(a)}return Ma.countryColorNoData}function M(a,b){Ja.find(".gc-slide-menu .gc-list").find("table tr[data-country-code="+a+"]").find(".gc-ranking").css("backgroundColor",b)}function N(a){return ka(a)?na(a):Ma.countryStrokeColor}function O(a){var b=c.rgb(Ma.selectedCountryColor).toString(),d=c.rgb(c.select(this).style("fill")).toString(),e=b===d;ka(a)&&!e&&(xa.selectAll("path").style("fill",L).style("stroke",N),c.select(this.parentNode.appendChild(this)).transition().style({fill:Ma.selectedCountryColor,stroke:Ma.selectedCountryStrokeColor}),P(a),S(a))}function P(a){var c=a.properties.country,d={countryLabel:pa(c.label)&&!sa(c.label)?c.label:c.code,continent:c.continent,dataType:R(Ka.selectedType),value:c.values[Ka.selectedType],percent:z(c.values[Ka.selectedType]/Va),unit:Q()};Ja.find(".gc-single-country-info").fadeIn(),Ja.find(".gc-single-country-info").loadTemplate(b("#gc-single-country-info-template"),d)}function Q(){for(var a=0;a<Ka.types.length;a++)if(Ka.types[a].type===Ka.selectedType)return ra(Ka.types[a].unit)?Ka.types[a].unit:"";return""}function R(a){for(var b=0;b<Ka.types.length;b++)if(Ka.types[b].type===a)return Ka.types[b].label;return""}function S(a){var c=Ja.find(".gc-slide-menu .gc-list"),d=c.find("table tbody tr");if(d.removeClass(Pa.selectedCountryInMapList),pa(a)){var e=a.properties.iso_a2;d.each(function(){b(this).data("country-code")===e&&(b(this).addClass(Pa.selectedCountryInMapList),b(this).find(".gc-ranking").css("backgroundColor",Ma.selectedCountryColor))})}}function T(){c.event.scale<1&&(c.event.scale=1);var a=c.event.translate,b=c.event.scale;a=ea(a,b),fa(b),xa.selectAll("path").style("stroke-width",Ta(b)+"px"),xa.attr("transform","translate("+a+")scale("+b+")"),Ca.translate(a),Ca.scale(b)}function U(){function a(a){var c=!b(this).hasClass(Pa.inactiveOverlayButton),d=a.zoomIn===!0||a.zoomIn===!1;if(c&&d){var e=Ca.scale(),f=Ca.translate(),g=[f[0]-ya/2,f[1]-za/2],h=Math.round(a.zoomIn?e+1:e-1),i=[g[0]/e*h,g[1]/e*h],j=[i[0]+ya/2,i[1]+za/2];j=ea(j,h),wa.transition().duration(100).call(h>=Oa.zoomRange[0]&&h<=Oa.zoomRange[1]?Ca.scale(h).translate(j).event:h>Oa.zoomRange[1]?Ca.scale(Oa.zoomRange[1]).translate(j).event:Ca.scale(Oa.zoomRange[0]).translate(j).event)}}Ja.find(".gc-zoom-plus").click(function(){a.apply(this,[{zoomIn:!0}])}),Ja.find(".gc-zoom-minus").click(function(){a.apply(this,[{zoomIn:!1}])})}function V(){Ja.find(".gc-fullscreen-open").click(X),Ja.find(".gc-fullscreen-close").click(Y)}function W(){Ja.find(".gc-spinner").show(),Ja.find("svg > g").hide()}function X(){b(this).is(":not(:hidden)")&&(!function(a){var b=a[0];b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()}(Ja),Oa.fullscreen&&Ja.addClass(Pa.fullscreen),b("html").css({overflow:"hidden"}),Ja.find(".gc-single-country-info").fadeOut(),b(this).fadeOut(),Ja.find(".gc-fullscreen-close").fadeIn(),s())}function Y(){b(this).is(":not(:hidden)")&&(!function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}(),Oa.fullscreen&&Ja.removeClass(Pa.fullscreen),b("html").css({overflow:"visible"}),Ja.find(".gc-single-country-info").fadeOut(),b(this).fadeOut(),Ja.find(".gc-fullscreen-open").fadeIn(),s(),aa())}function Z(){var a=Ja.find(".gc-slide-menu .gc-menu"),b=Ja.find(".gc-button.gc-show-slide-menu"),c=Ja.find(".gc-hide-slide-menu-area");b.click(function(){a.animate({left:0}),b.fadeOut(),c.fadeIn(),"undefined"!=typeof Ga&&Fa.scrollToX(Ga.position().left-30)}),c.click(function(){a.animate({left:-(a.outerWidth()+20)}),b.fadeIn(),c.fadeOut()})}function $(){Ja.find(".gc-button.gc-color-function-select").change(function(){Wa=Qa[b(this).find("option:selected").val()],Ja.find(".gc-single-country-info").fadeOut(),Ja.find(".gc-slide-menu .gc-list").find("tr").removeClass("selected").find(".gc-ranking").removeAttr("style"),_(),G()})}function _(){v(),u()}function aa(){Ja.find(".gc-list .gc-scroll-pane").jScrollPane({verticalDragMinHeight:70})}function ba(){var a=Ja.find(".gc-data-type-chooser"),b=a.find(".gc-scroll-pane");Fa=b.jScrollPane({showArrows:!0,animateScroll:!0,speed:200}).data("jsp"),H()}function ca(){Ja.find(".gc-button.gc-settings").click(function(){var a=b(this).find(".gc-icon-settings"),c=b(this).find(".gc-icon-settings-hide");b(this).hasClass(Pa.settingsShown)?(b(this).removeClass(Pa.settingsShown),b(this).animate({bottom:10},"fast"),Ja.find(".gc-settings-wrapper").animate({bottom:-55},"fast"),c.fadeOut("fast"),a.fadeIn("fast")):(b(this).addClass(Pa.settingsShown),b(this).animate({bottom:50},"fast"),Ja.find(".gc-settings-wrapper").animate({bottom:10},"fast"),c.fadeIn("fast"),a.fadeOut("fast"))})}function da(){Ja.find("select.gc-data-type-select").loadTemplate(b("#gc-data-type-chooser-select-template"),Ka.types)}function ea(a,b){if(oa()){var c=(Ja.width()-ya)*b-Ja.width()*(b-1);a[0]=Math.min(0,Math.max(c,a[0]))}else a[0]=Math.min(0,Math.max(ya*(1-b),a[0]));return a[1]=Math.min(0,Math.max(za*(1-b),a[1])),a}function fa(a){var b=.05;a<Oa.zoomRange[0]+b?(Ja.find(".gc-zoom-minus").addClass(Pa.inactiveOverlayButton),Ja.find(".gc-zoom-plus").removeClass(Pa.inactiveOverlayButton)):a>Oa.zoomRange[1]-b?(Ja.find(".gc-zoom-plus").addClass(Pa.inactiveOverlayButton),Ja.find(".gc-zoom-minus").removeClass(Pa.inactiveOverlayButton)):(Ja.find(".gc-zoom-plus").removeClass(Pa.inactiveOverlayButton),Ja.find(".gc-zoom-minus").removeClass(Pa.inactiveOverlayButton))}function ga(a){return Ya.init(a),ia()}function ha(a){ja(),Ya.init(a)}function ia(){return{destroy:ja,setConfig:ha}}function ja(){b(Xa).empty().removeAttr("class").removeAttr("style")}function ka(a){return pa(a.properties.country)?pa(a.properties.country.values[Ka.selectedType]):!1}function la(a){var b=a.properties.country.values[Ka.selectedType],c=Wa(b);return Sa(c)}function ma(a){var b=la(a),d=c.interpolateRgb(Ma.countryColorRangeStart,Ma.countryColorRangeEnd);return d(b)}function na(a){return c.rgb(ma(a)).darker().toString()}function oa(){return Ja.hasClass(Pa.fullscreen)}function pa(a){return"undefined"!=typeof a&&null!==a}function qa(a){return pa(a)&&(typeof a===Object||"object"==typeof a)}function ra(a){return pa(a)&&(typeof a===String||"string"==typeof a)}function sa(a){return ra(a)&&""===a}function ta(){var a=[];for(var c in Ka.countries)if(Ka.countries.hasOwnProperty(c)){var d=Ka.countries[c];a.push(b.extend(!0,{},d,{code:c}))}return a}var ua="0.0.1",va={};va["overlays.tpl"]='<div class="gc-spinner"></div><div class="gc-overlay"><div class="gc-button gc-show-slide-menu"><span class="gc-icon gc-icon-menu"><span class="gc-inner"></span></span></div><div class="gc-button gc-zoom-plus"><div class="gc-icon gc-icon-plus"></div></div><div class="gc-button gc-zoom-minus"><div class="gc-icon gc-icon-minus"></div></div><div class="gc-button gc-settings"><div class="gc-icon gc-icon-settings"><div class="gc-inner"></div></div><div class="gc-icon gc-icon-settings-hide"></div></div><div class="gc-settings-wrapper"><div class="gc-color-function-select-wrapper"><div class="gc-icon gc-icon-select"></div><div class="gc-select-label"></div><select class="gc-button gc-color-function-select"><option value="log"></option><option value="linear"></option><option value="quadratic"></option><option value="sqrt"></option><option value="cubicroot"></option></select></div><div class="gc-data-type-select-wrapper"><div class="gc-icon gc-icon-select"></div><div class="gc-select-label"></div><select class="gc-button gc-data-type-select"></select></div></div><div class="gc-single-country-info"></div><div class="gc-slide-menu"><div class="gc-hide-slide-menu-area"></div><div class="gc-menu"><div class="gc-title"><span class="gc-value"></span><span class="gc-date"></span></div><div class="gc-data-type-chooser"><div class="gc-menu-separator-line"></div><div class="gc-scroll-pane"></div></div><div class="gc-list"><a class="gc-csv-download" target="_blank"><span class="gc-icon gc-icon-download"><span class="gc-inner"></span></span> <span>.csv</span></a><div class="gc-scroll-pane"><table><tbody></tbody></table></div></div></div></div><div class="gc-button gc-fullscreen-open"><span class="gc-icon gc-icon-fullscreen-open"><span class="gc-inner"></span></span></div><div class="gc-button gc-fullscreen-close"><span class="gc-icon gc-icon-fullscreen-close"><span class="gc-inner"></span></span></div></div>',va["templates.tpl"]='<script type="text/html" id="gc-single-country-info-template"><div> <span data-content="countryLabel"></span> <span data-content="continent" class="gc-continent"></span> </div> <div class="gc-data-type"> <span class="gc-value"> <span data-content="value"></span><span data-content="unit"></span> </span> <span class="gc-percent" data-content="percent"></span> <span class="gc-title" data-content="dataType"></span> </div></script><script type="text/html" id="gc-slide-menu-table-template"><tr data-template-bind=\'{"attribute": "data-country-code", "value": "code"}\'> <td> <span data-content="ranking" class="gc-ranking"></span> </td> <td> <span data-content="label" class="gc-country-name"></span> <span data-content="continent" class="gc-continent" data-template-bind=\'{ "attribute": "style", "value": "displayContinent" }\'></span> </td> <td> <span class="gc-percent" data-content="percent"></span> </td> <td> <span data-content="value"></span><span data-content="unit"></span> </td> </tr></script><script type="text/html" id="gc-data-type-chooser-template"><span class="gc-tab" data-content="label" data-template-bind=\'[{ "attribute": "data-type", "value": "type" }]\'></span></script><script type="text/html" id="gc-data-type-chooser-select-template"><option data-content="label" data-value="type"></option></script>';var wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka={},La={date:"YYYY-MM-DD"},Ma={seaColor:"#B8D5EA",countryColorRangeStart:"rgb(182,218,195)",countryColorRangeEnd:"rgb(7,84,37)",countryColorNoData:"#efefef",countryStrokeColor:"#CCC",countryStrokeWidthMin:"0.07",countryStrokeWidthMax:"0.3",selectedCountryColor:"#FFE700",selectedCountryStrokeColor:"#000000"},Na={mapListTitle:"Data Distribution",configurationDataType:"DATA TYPE",configurationColorFunction:"COLOR FUNCTION",colorFunction:{log:"Logarithmic",linear:"Linear",quadratic:"Quadratic",sqrt:"Square Root",cubicroot:"Cubic Root"}},Oa={mapName:"geochart-world-map",zoomRange:[1,9],fullscreen:!0,noControls:{inGeneral:!1,inSmallMap:!0,smallMapThreshold:600}},Pa={container:"gc-map-wrapper",fullscreen:"gc-fullscreen",noFullscreen:"gc-no-fullscreen",smallMap:"gc-small-map",noControls:"gc-no-controls",activeTab:"gc-active",selectedCountryInMapList:"gc-selected",inactiveOverlayButton:"gc-inactive",settingsShown:"gc-shown"},Qa={log:function(a){return Math.log(a)},linear:function(a){return a},quadratic:function(a){return Math.pow(a,2)},sqrt:function(a){return Math.sqrt(a)},cubicroot:function(a){return Math.pow(a,1/3)}},Ra=[],Sa=c.scale.linear().range([0,1]),Ta=c.scale.linear().domain(Oa.zoomRange).range([Ma.countryStrokeWidthMax,Ma.countryStrokeWidthMin]),Ua=0,Va=0,Wa=Math.log,Xa="#geochart-map",Ya=function(){function a(a){function b(b){if(ra(a.data))c.json(a.data,function(a){if(!qa(a))throw ja(),"geochart needs a valid data object";a.hasOwnProperty("data")?Ka=a.data:qa(a)&&(Ka=a),t(b)});else{if(!qa(a.data))throw ja(),"geochart needs a valid data object";Ka=a.data,t(b)}}e(),s(a),function(){if(ra(a.map))c.json(a.map,function(a){b(a)});else{if(!qa(a.map))throw ja(),"geochart needs a valid input map";b(a.map)}}(),u()}function e(){function a(a){if(!pa(a.lib))throw ja(),"geochart needs the library "+a.name}a({lib:b(document).loadTemplate,name:"jQuery loadTemplate"}),a({lib:b(document).jScrollPane,name:"jQuery jScrollPane"})}function s(a){f(a),g(),h(),q(),r()}function t(a){if(!pa(a.objects[Oa.mapName]))throw ja(),"geochart needs a valid map as input. you probably did not set the TopoJSON mapName correctly.";Da=d.feature(a,a.objects[Oa.mapName]),j(),l(),k(),m(),n(),i(),function(){o(),p()}(),function(){_(),x(),aa()}(),function(){B(),ba(),da(),E(),D()}(),function(){Da=w(Da),I()}()}function u(){U(),V(),Z(),ca(),$(),C()}return{init:a}}();a.geochart={version:ua,generate:ga}}(window,jQuery,d3,topojson,moment);